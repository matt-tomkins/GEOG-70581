[["index.html", "Chapter 1 Introduction 1.1 Practical outline 1.2 Objectives", " Hydrological analysis in R Chapter 1 Introduction 1.1 Practical outline In this set of practicals, well be using R, RStudio and WhiteboxTools to perform hydrological analysis. In Chapters 2 and 3, well install and get to grips with the required programs. In Practical 1 (Chapters 4 - 6), which uses data for the Eskdale watershed, well introduce you to some of the key approaches, including DEM pre-processing, calculating flow parameters and comparing flow algorithms. In Practical 2 (Chapters 7 - X), well utilise these approaches to investigate the water quality of the Mersey Basin. This forms the basis for your assessment. 1.2 Objectives After completing these practicals, you will: have gained experience with new tools (e.g. R, RStudio, WhiteboxTools); become familiar with hydrological approaches used to simulate overland flow from digital elevation models (DEMs); utilised statistical analysis to investigate the relationships between water quality indicators and catchment characteristics; improved your understanding of the hydrological processes influencing water quality. "],["Installation.html", "Chapter 2 Installation 2.1 R 2.2 R Studio 2.3 Course materials", " Chapter 2 Installation During this practical you will be using WhiteboxTools, an open-source GIS software package for hydro-geomorphic applications. While it contains much of the functionality found in a standard GIS software package, it also includes novel functionality specific to hydrological analysis. The tools are also computationally efficient (i.e. fast!), taking advantage of parallel processing and other advancements in computing power. Finally, the tools are developed for cross-platform use, so can be accessed through code (e.g. R, Python) or other GUIs (e.g. QGIS, ArcGIS) if required. To run WhiteboxTools functions (WBT), well be using R as a front-end interface. This will allow us to access and run all of the relevant hydrological functions from WBT, while utilising the statistical and visualisation capabilities of R. 2.1 R To Install R: Open an internet browser and go to https://www.r-project.org/. Click the download R link in the middle of the page under Getting Started. Select a CRAN location (a mirror site) and click the corresponding link e.g. the site provided by Imperial College London. Click on the Download R for Windows link, or the relevant link for your operating system (macOS, Linux). Click on base and then Download R [Version Number] for Windows. The current version is 4.1.1. Once downloaded, double click the application file (.exe) and follow the installation instructions. 2.2 R Studio While R is now installed, it is good practice to use an integrated development environment (IDE) to access and run R functions. The most well known IDE for R is RStudio, which includes a console, higher quality graphics, as well as tools for plotting, history, debugging and workspace management. Note: R may be used without RStudio, but RStudio cannot be used without R. To Install RStudio: Go to https://www.rstudio.com/products/rstudio/download/ and click on Download RStudio for Windows. Installers for macOS and other operating systems are available below. Once downloaded, double click the application file (.exe) and follow the installation instructions. 2.3 Course materials All the data required for this sets of practicals is available on Blackboard or can be downloaded here. "],["Intro_to_R.html", "Chapter 3 A (brief) introduction to R 3.1 Overview 3.2 Loading R 3.3 Variables 3.4 Scripts 3.5 Comments 3.6 Whitebox Tools 3.7 Using R packages 3.8 Vectors 3.9 Loading data", " Chapter 3 A (brief) introduction to R 3.1 Overview 3.1.1 What is R? R was originally focused on statistical data analysis, but has evolved into a general-purpose high level programming language. High level languages are typically less complicated and more user friendly than low level languages (e.g. C, C++, Java), but this comes at the expense of being slightly slower to execute. Importantly, R is free and open-source and its core functionality can be extended using packages. These are available through the Comprehensive R Archive Network (CRAN) and allow the user to perform a range of both simple and complex tasks (e.g. reading and writing files, rendering images), without the requirement to delve into the underlying source code. While there are a myriad of free online resources available to help you learn R, including R for Data Science and YaRrr! The Pirates Guide to R, as well as paid options from Data Camp, this chapter and the subsequent practicals will equip you with all the skills required to complete the course. 3.1.2 Why code? For those of you familiar with desktop GIS (e.g. ArcGIS, QGIS) or other statistical programs (e.g. Excel, SPSS), the transition to using code can be a frightening experience! However, there are a several reasons why it is worth persevering with. First, and with career progression in mind, the ability to code is becoming increasingly important, particularly for those of you who want to progress down GIS or environmental career paths. Getting to grips with R and understanding the fundamentals of coding will equip you to learn new skills and new coding languages which may be required by a future employer (e.g. Python, MATLAB, Julia, Ruby, ). Second, performing your analysis using code ensures that your outputs are reproducible. If you provide someone else with the original data files and the corresponding code i.e. a list of operations carried out by the computer (e.g. read data, modify, plot, perform statistical test, save), they should be able to reproduce your outputs exactly. Third, code is repeatable. In standard GIS software (for example), most functions allow you to perform a single task on a single data file e.g. clipping a digital elevation model to the geometry of a shapefile. By comparison, if that same functionality can be implemented in code, it can applied as easily to 10 data files, or 1000, or 10,000. Finally, code is easily modifiable. Code can be tweaked, adapted, or completely rewritten to produce the desired outputs. In R, a wide range of functions are already available in packages, but you can write your own functions or combine existing functions to suit your analysis. This functionality is often not the case in other software, which are more complicated to modify and typically provide Black Box solutions, where we can inspect the inputs and outputs, but typically have limited understanding of the steps in between. Black Box programming 3.1.3 A quick note on the practicals As we progress through this course, make sure to read the content carefully. However, you do not have to run every bit of code in this document, although have a go where you feel it would help your understanding. If I explicitly want you to do something, I will write an instruction that looks like this: This is an instruction that tells you something to either think about, or do. 3.1.4 Dealing with errors Before we load R and take our first steps towards coding excellence, it is worth noting that errors are an inevitable aspect of coding. Irrespective of how good you are, you will spend more time fixing your code (i.e. debugging) than writing it! Luckily, when R encounters an error, it will try and help you out. For example, shown below is some simple R code. Here, we are tying to create a new variable called a, which is the product (+) of variable b and the number 1: a &lt;- b + 1 ## Error in eval(expr, envir, enclos): object &#39;b&#39; not found In this example, the code fails and prints the error message object 'b' not found because the variable b does not exist! We could solve this by defining b beforehand as follows: b &lt;- 3 a &lt;- b + 1 a ## [1] 4 These error messages are important and contain helpful information - do not ignore them! If youve struggled to resolve the problem, you should then Google it (normally by just typing R followed by the error message into Google), e.g. R Error in eval(expr, envir, enclos): object 'b' not found. Another useful source of information is StackOverflow which is a public collection of coding questions and answers. If youve come across a challenging error, theres a high probability that someone else has also encountered the same error, and there may be a solution already available. Understanding, interpreting and fixing error messages is a key programming skill, so read the error messages carefully and use the above resources (Google, StackOverflow). If you need any additional help, staff and TAs will be happy to help during the practicals. 3.2 Loading R Now that we understand what R is, why its useful and what to do when something goes wrong, lets begin. Open RStudio. The RStudio user-interface should resemble the following: This contains the following primary windows, which are described below: In the console window, commands can be typed and results returned. For example, typing the following command into the console: 1 + 2 produces: ## [1] 3 Copy and paste the above code into the console and press Enter to run. Does it produce the correct result? In the Workspace window, you can see all the objects that you have created in the current R session (Environment tab; currently empty!) as well as a record of the commands youve used (History tab; 1 + 2). At its most basic, R can operate as a powerful calculator. We can add +, subtract -, multiply * and divide /, take the exponent ^, calculate the square root sqrt() or the logarithm of a number log10(), or melt our computers by using the factorial() function. We can also combine operators to produce more complicated commands. For example, the following code takes the sqrt() of 25 and then takes its factorial (\\(5!\\)), which is equal to \\(5 * 4 * 3 * 3 * 1\\). factorial(sqrt(25)) ## [1] 120 3.3 Variables One of the most important things to know about in R is the variable or object. In this set of practicals, we use the term variable, which is more common across different programming languages. Variables are containers that you can store values in, and then refer to again later. R creates variables for you automatically, so all that is required is to name it and then use the assignment operator &lt;- to assign a value to it. As a general rule (and because of complicated reasons), use &lt;- for assignment, as shown below, and dont use =: b &lt;- 3 Run the above code. This assigns the value of 3 to a variable named b: You should now see that under the Workspace window, the variable b has been added to the Environment tab: The variable b can now be called again by the user. Run the following in the console. Does it work as expected? b + 5 There are number of benefits to using variables. For example, take the following: a &lt;- 5 b &lt;- 10 result &lt;- (sqrt(a) + log(b))^a + 2*b result ## [1] 1945.905 This is a relatively complicated mathematical formula! It uses a square root sqrt() and logarithm log() function, as well as multiplication * and powers ^. We could replicate this result by substituting each value of a for 5 and each value of b for 10, but this would be time consuming and prone to error, and would be very frustrating if we wanted to re-calculate the result for a = 6 and b = 11! Using variables allows us to use and modify values multiple times within the code. In addition, using variables is important for repeatability. Lets say we want to calculate the sum of the squares from 1 to 5 i.e. \\(1^2 + 2^2 + 3^2 + 4^2 +5^2\\). We could write this numerically in R as follows: 1^2 + 2^2 + 3^2 + 4^2 + 5^2 This produces the current result: ## [1] 55 However, what if wanted to perform this calculation for all the numbers from 1 - 50 i.e. \\(1^2 + 2^2 + 3^2 + ... + 50^2\\)? What if we wanted to cube each value (i.e. \\(n^3\\)), rather than squaring? Either change would require a great deal of manual editing, with lots of potential for error. By comparison, using variables allows us to loop through a series of calculations. The code below creates a variable called result and loops through a sequence of numbers using seq() to perform the above calculation, where the variable i is updated each iteration. # Initialises a variable called result, with a value of 0 result &lt;- 0 # Loops through a sequence from 1 to 5 in increments of 1 (i.e. 1, 2, 3, 4, 5) for(i in seq(from = 1, to = 5, by = 1)){ # Squares each number (i) and adds to result result &lt;- result + i^2 } result ## [1] 55 Run the above code in the console. Try to modify the code to perform the calculation for 1 - 50; this should equal \\(42925\\) At this stage, dont worry about understanding the syntax of the code above. The important thing to remember is that using variables allows to us to perform more complex and more robust analyses. 3.3.1 Variable names When defining a variable name, you cant use spaces or characters that are not a-z, A-Z or 0-9. As a general rule, variables in R should be written in snake case (as opposed to upper case or lower case) where all words are in lower case and are separated by underscores (_). All of these are valid variable names in snake case: snake_case a_really_long_snake_case_name snake s Other popular naming conventions include camelCase, UPPER_CASE or hyphen-case (among many others). Pick one and use it consistently. 3.3.2 Variable types Each variable will have a particular type, which specifies what kind of a value it can hold. Whilst this is handled automatically for you by R, it is important that you understand what the different types are. Here are some common examples: # Character i.e. a string of letters, numbers and/or characters a &lt;- &quot;Bill&quot; # Numeric i.e. a number with decimals b &lt;- 3.567 # Integer c &lt;- 3 # Logical i.e. TRUE or FALSE d &lt;- TRUE Run the above code. If successful, your workspace should now include the variables a, b, c, d. Some data types are compatible e.g. # Numeric + integer b + c ## [1] 6.567 But others are not! # Numeric + character b + a ## Error in b + a: non-numeric argument to binary operator 3.4 Scripts So far weve been typing commands into the console. This works as expected; we can print results, store variables in the workspace and create plots in the plots window. However, it is often more convenient to store our code in a script, which is simply a file containing a set of commands and comments. For example, a single R script could contain commands to load data, perform statistical analysis, and output the results to a new file. This can be run in a single keystroke, which is much simpler than typing or copying and pasting each command in one after another. To create a new R script: Navigate to File, New File and R Script. This should open a new window, with a new untitled R script: To save the script: Navigate to File and Save As, and save it in the GEOG70581 folder with an appropriate name (e.g. learning_R) Scripts work identically to the console 3.5 Comments 3.5.1 Packages 3.6 Whitebox Tools To Install WBT: 3.7 Using R packages Heres the packages well be using: Raster Sp ggplot2  3.7.1 Plots, files and packages This window provides access to plots created by the user, packages loaded to the environment, or files that are accessible in the working directory. To demonstrate this, well generate some random data using the following code, which uses the rnorm function. This generates 100 values, normally distributed at 10 ± 2 (mean ± standard deviation). x &lt;- rnorm(100, mean = 10, sd = 2) plot(x) Run the above code. A new variable x should be stored in the environment, and a plot should have been generated in the plots window, resembling the following. Note: your output will differ from that shown below as the underlying data have been generated randomly. A random distribution generated using rnorm 3.8 Vectors # Creating a list of numbers ls &lt;- c(1, 2, 3, 4, 5) ls ## [1] 1 2 3 4 5 # Creating a sequence sq &lt;- seq(1,5,1) sq ## [1] 1 2 3 4 5 # Creating a repetitive list rp &lt;- rep(10, 5) rp ## [1] 10 10 10 10 10 # Multiplying together ls * rp ## [1] 10 20 30 40 50 3.9 Loading data # Load data df &lt;- read.csv(&quot;C:/Users/44797/Desktop/Repo/GEOG-70581/data/flow_data.csv&quot;) head(df) ## Date Flow_m3.s ## 1 01/10/1982 24.070 ## 2 02/10/1982 7.129 ## 3 03/10/1982 4.289 ## 4 04/10/1982 7.610 ## 5 05/10/1982 4.932 ## 6 06/10/1982 3.706 # What columns do we have colnames(df) ## [1] &quot;Date&quot; &quot;Flow_m3.s&quot; # What data do they store? str(df) ## &#39;data.frame&#39;: 13514 obs. of 2 variables: ## $ Date : chr &quot;01/10/1982&quot; &quot;02/10/1982&quot; &quot;03/10/1982&quot; &quot;04/10/1982&quot; ... ## $ Flow_m3.s: num 24.07 7.13 4.29 7.61 4.93 ... # We can access columns by using the $ operator # df$Date # df$Flow This is a dataframe, containing two columns, in a similar format to something you may be familiar with in Excel. It has a column of dates and a column of river flow (measured in m^3 per second). We may want to index using df[row.index, column.index] # We can extract certain rows # Extract rows 1 to 4, all columns df[1:4,] ## Date Flow_m3.s ## 1 01/10/1982 24.070 ## 2 02/10/1982 7.129 ## 3 03/10/1982 4.289 ## 4 04/10/1982 7.610 # Extract rows 1 to 4, just the second column df[1:4, 2] ## [1] 24.070 7.129 4.289 7.610 "],["FirstPractical.html", "Chapter 4 Eskdale 1 - Introduction 4.1 Overview", " Chapter 4 Eskdale 1 - Introduction It should be evident from the lectures that digital elevation models (DEMs) have a great deal of potential for modelling surface water hydrology and related phenomena in drainage basins. Much of this work is based on the assumptions that (1) we can trace the path that water will take from any point in an elevation grid to a basin outlet, and (2) the discharge of water from a particular location is directly related to its catchment area. This is a fairly reasonable assumption in most drainage basins. 4.1 Overview In this lab exercise, we will use a DEM of the Upper Eskdale watershed to model flow-related phenomena, and will have gained experience in: DEM pre-processing; Calculating flow parameters (e.g. pointers and contributing areas); Comparing flow algorithms. Upper Eskdale catchment 4.1.1 Intended learning outcomes In Chapter 4, well download the data and install the required programs and packages, and will combine these in Chapter 5 to: gain experience with WhiteboxTools, a specialist GIS specifically designed for digital terrain analysis (DTA); become familiar with some of the most commonly used flow algorithms used to simulate overland flow from digital elevation models (DEMs); considere the utility of DTA for routing applications; 4.1.2 Assessment This practical is formative and as such will not count towards your final mark for GEOG70581, but you are encouraged to complete the practical to the best of your ability, and to have one or more attempts at the formative quiz. 4.1.3 Quiz There is an on-line Blackboard quiz associated with this practical that you are encouraged to complete. The quiz can be found in the Week Seven practical folder on the Blackboard site for this course. The quiz consists of six questions. You can have multiple attempts at the quiz. "],["Eskdale_set_up.html", "Chapter 5 Eskdale 2 - Set-up 5.1 Install programs 5.2 Download data 5.3 Open RStudio 5.4 Initialise an R project 5.5 Creating an R script 5.6 Install required packages", " Chapter 5 Eskdale 2 - Set-up 5.1 Install programs If you havent installed R and RStudio, please refer to the instructions here before continuing. 5.2 Download data The data for this practical can be downloaded here. Download the folder, save it to an appropriate location and extract the contents (unzip). The directory structure is as follows: Data Practical_1 Practical_2 Images Practical_1 Practical_2 Output Practical_1 Practical_2 All the required data files for Practicals 1 and 2 are stored in the associated sub-directory within Data. As we move through the practicals, well be creating a number of additional GIS files and we encourage you to save these within the corresponding sub-directory within Output. Finally, maps and figures will be required for the assessment. These can be exported directly from R and stored in Images. 5.3 Open RStudio To begin, open RStudio. 5.4 Initialise an R project To initialise a new R project: Go to File, New Project, and select Existing Directory. Using the Browse icon, set the project working directory to the folder GEOG70581, which you downloaded and unzipped here. Select Create new project If this has been successful, your console should have been updated to include the path to your project working directory as follows: 5.5 Creating an R script To initialise a new R project: 5.6 Install required packages "],["Eskdale_flow_algorithms.html", "Chapter 6 Eskdale 3 - Flow routing 6.1 DEM pre-processing: flow enforcement 6.2 Calculating Flow Parameters: Pointers 6.3 Comparing flow algorithms", " Chapter 6 Eskdale 3 - Flow routing 6.1 DEM pre-processing: flow enforcement 6.2 Calculating Flow Parameters: Pointers 6.3 Comparing flow algorithms "],["SecondPractical.html", "Chapter 7 Practical 2 - Mersey 7.1 Part 1: Overview", " Chapter 7 Practical 2 - Mersey Within a Geographical Information System (GIS) framework, readily available spatial datasets, such as land use and geology, have been used to explore the controls on river water quality. Understanding the relationships between catchment characteristics (or metrics) and river water quality provides a base for determining how future changes in both land use and climate will impact river water quality. Therefore, it is important to determine the processes that regulate river water quality in landscapes under increasing pressure from human population, whether from urbanisation or more intensive food production. The Mersey Basin is one of the UKs most environmentally varied regions, with rich rural landscapes and urban-industrial centres. Industrial prosperity in the region over the last few hundred years resulted in severe pollution of the many rivers in the basin. Although there has been significant improvements in water quality in recent years the rivers in the Mersey Basin are still subjected to a number of sewage and industrial inputs, and agricultural runoff. 7.1 Part 1: Overview In this practical you will explore the controls on river water quality in the Mersey Basin and develop empirical models of river water quality across the region. 7.1.1 Topics covered in this practical Terrain analysis, including catchment delineation and derivation of catchment characteristics; Writing and execution of scripts; Multiple Linear Regression to create models of catchment hydrochemistry; Using models to create spatial predictions of catchment hydrochemistry using WhiteboxTools. 7.1.2 Intended Learning Outcomes Gain practical experience of modelling environmental phenomena using a Geographical Information Systems (GIS) framework; Gain practical experience of hydrological modelling using GIS; Gain practical experience of manipulating and analysing raster datasets; Gain practical experience of using Map Algebra functions and writing scripts; Gain practical experience of using multivariate analysis; Understand some of the key controls on river water quality; Be able to critically evaluate model outputs. 7.1.3 Assessment This practical is assessed by completion of the tasks outlined in this document, full details of which are provided here. You will need to write up the practical in the format of a report. This practical is worth 50% of your overall mark for GEOG70581. As well as the standard SEED PGT criteria, you will also be assessed on your ability to: Effectively follow instructions to complete the practical tasks (technical prowess), i.e. producing the regression equations and output images correctly; Analyse and interpret the outputs in the context of your knowledge of river hydrochemistry (and with reference to appropriate literature); Relate the monitoring and modelling approaches here to theory covered earlier in the course (and with reference to appropriate literature); Explain ideas clearly and concisely; Present figures and data clearly and effectively; Be original and insightful in terms of independent research and additional analysis of the data where appropriate. Use references to relevant academic literature to support your arguments; The deadline for this practical is 2pm on Thursday 4th February 2021. The word count for this practical is 2,000. "],["Assessment.html", "Chapter 8 Assessment", " Chapter 8 Assessment Title: Modelling River Hydrochemistry Word Limit: 2000. The guidelines provided in the CO2 flux practical, which outline what is and what is not included in the word count, as well penalties for exceeding the word count, also apply here. Format: Report Structure: Your report should be a coherent document, as opposed to a list of Q&amp;As as with the CO2 flux practical. Within this, how you structure the report is your decision. However, there are certain items that must be included in the main body of the report. These are the regression equations (and associated information i.e. significance values, R2 etc) for all ten water quality indicators, and your three spatial predictions of river water quality. You can choose which three water quality indicators you focus on for the spatial predictions, but you should justify your choice in the report. As well as these important items, the following points must be covered in the report: What are the relationships between water quality and catchment characteristics? Are there any consistent predictors of water quality? How good are the regression models? What sort of errors may occur during the derivation of catchment characteristics? How could these errors be minimised? How could you validate the models? Are there any patterns in modelled river water quality? Are your predictive maps of water quality useful? Are there any errors / limitations when constructing maps of this type? How could you improve the spatial predictions? Your report should not just be a reworked version of the practical instructions. In fact, there is no need to include a methodology section at all, although you may wish to reflect on the methods used when considering the points above. You may find it useful to refer to the my learning essential resources on report writing ([https://www.library.manchester.ac.uk/using-the-library/students/training-and-skills-support/my-learning-essentials/online-resources/) In addition to the above, you must produce maps for each of the following files created during the practical exercise. These are listed using the file names used above, but check these carefully if you used a different naming format. These need to be included in an Appendix at the back of the report (ideally two images per page): D8 specific contributing areas (SCA)  (mersey_DEM_fill_D8_SCA); Watersheds in the Mersey Basin, derived from the 70 modified Environment Agency seed points  (mersey_watersheds); Boolean (logical) raster of urban land cover  (mersey_LC_Urban); Boolean (logical) raster of permeable HOST soil cover  (mersey_HOST_Perm); Boolean (logical) raster of coal bedrock  (mersey_bedrock_Coal); Slope map  (mersey_DEM_fill_slope); Streams raster, created using the specific contributing area (SCA) and a channelization threshold of 10 (log-transformed)  (mersey_Streams_SCA10); Masked sub-basins  (mersey_subsbasin_mask). Presentation of Images: All maps should have a scale bar, north arrow and legend, all of which can be added in Whitebox under the Cartographic dropdown menu. Maps can be exported from Whitebox to image format (e.g. .png) using Export Map as Image. Referencing: The report should be fully referenced, using the Harvard style. You should not just adapt the text from the Rothwell paper, substituting key values for the data here. This will result in a high similarity index and you may face a penalty due to poor academic practice. You must write up the report in your own words, making sure you paraphrase the ideas of others, and reference fully throughout. Submission deadline: XX/XX/XXXX, XX:XX "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
